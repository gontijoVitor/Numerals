<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numerals</title>

    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="./css/style.css">

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="./img/favicon.png">
</head>
<body>

<div class="main">
    <h1>Numerals - Medium</h1>

    <nav>
        <a href="index.html">Easy</a> |
        <a class="active">Medium</a> |
        <a href="hard.html">Hard</a>
    </nav>

    <div class="board">
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
    </div>

    <form onsubmit="processInput(); return false;" autocomplete="off">
        <input type="text" id="userInputField" maxlength="5" placeholder="Give it a try!">

        <div>
            <button type="button" onclick="toggleTheme()">
                <i class="fa-solid fa-moon"></i>
            </button>
            <button type="button" onclick="rules()">
                <i class="fa-solid fa-file-lines"></i> How to play
            </button>
            <button type="submit" id="submitguess">
                <i class="fa-solid fa-share"></i> Submit
            </button>
        </div>
    </form>

    <div id="output"></div>
</div>

<script>
/* =========================
   DAILY SEED SYSTEM
========================= */
const START_DATE = new Date("2024-01-01");

function daysSinceStart() {
    const today = new Date();
    today.setHours(0,0,0,0);
    return Math.floor((today - START_DATE) / (1000 * 60 * 60 * 24));
}

function getDailyNumber() {
    const dayIndex = daysSinceStart();
    const seed = dayIndex * 9301 + 49297;
    return ((seed % 90000) + 10000).toString();
}

const todayKey = "medium-" + new Date().toISOString().slice(0, 10);
const randomNumber = getDailyNumber();

/* =========================
   GAME STATE (MEDIUM)
========================= */
const maxAttempts = 5;
let currentAttempt = 0;
let gameOver = false;

const rows = document.querySelectorAll(".row");
const output = document.getElementById("output");
const input = document.getElementById("userInputField");

/* =========================
   RESTORE DAILY STATE
========================= */
const savedGame = JSON.parse(localStorage.getItem(todayKey));

if (savedGame) {
    currentAttempt = savedGame.currentAttempt;
    gameOver = savedGame.gameOver;

    savedGame.board.forEach((row, r) => {
        const cells = rows[r].querySelectorAll(".cell");
        row.forEach((cell, c) => {
            cells[c].textContent = cell.value;
            if (cell.state) cells[c].classList.add(cell.state);
        });
    });

    if (gameOver) showCountdown();
}

/* =========================
   WORDLE LOGIC
========================= */
function evaluateGuess(guess, secret) {
    const result = Array(5).fill(null);
    const used = Array(5).fill(false);

    // Green pass
    for (let i = 0; i < 5; i++) {
        if (guess[i] === secret[i]) {
            result[i] = "correct";
            used[i] = true;
        }
    }

    // Yellow pass
    for (let i = 0; i < 5; i++) {
        if (result[i]) continue;
        for (let j = 0; j < 5; j++) {
            if (!used[j] && guess[i] === secret[j]) {
                result[i] = "present";
                used[j] = true;
                break;
            }
        }
    }

    return result;
}

/* =========================
   INPUT HANDLER
========================= */
function processInput() {
    if (gameOver) return;

    const value = input.value.trim();

    if (!/^\d{5}$/.test(value)) {
        output.textContent = "Enter exactly 5 digits.";
        return;
    }

    const guess = value.split("");
    const secret = randomNumber.split("");
    const evaluation = evaluateGuess(guess, secret);

    const cells = rows[currentAttempt].querySelectorAll(".cell");

    for (let i = 0; i < 5; i++) {
        cells[i].textContent = guess[i];
        cells[i].classList.add(evaluation[i]);
    }

    currentAttempt++;
    input.value = "";

    saveGameState();

    if (value === randomNumber) {
        output.textContent = "ðŸŽ‰ You solved todayâ€™s Medium challenge!";
        gameOver = true;
        endGame();
        return;
    }

    if (currentAttempt === maxAttempts) {
        output.textContent = `âŒ Game Over! The number was ${randomNumber}`;
        gameOver = true;
        endGame();
    }
}

/* =========================
   SAVE STATE
========================= */
function saveGameState() {
    const board = Array.from(rows).map(row =>
        Array.from(row.querySelectorAll(".cell")).map(cell => ({
            value: cell.textContent,
            state: [...cell.classList].find(c =>
                c === "correct" || c === "present"
            )
        }))
    );

    localStorage.setItem(todayKey, JSON.stringify({
        currentAttempt,
        gameOver,
        board
    }));
}

/* =========================
   COUNTDOWN TIMER
========================= */
function endGame() {
    saveGameState();
    showCountdown();
}

function showCountdown() {
    const timer = document.createElement("div");
    timer.id = "countdown";
    output.appendChild(timer);

    setInterval(() => {
        const now = new Date();
        const tomorrow = new Date();
        tomorrow.setHours(24,0,0,0);

        const diff = tomorrow - now;
        const h = String(Math.floor(diff / 3600000)).padStart(2, "0");
        const m = String(Math.floor(diff % 3600000 / 60000)).padStart(2, "0");
        const s = String(Math.floor(diff % 60000 / 1000)).padStart(2, "0");

        timer.textContent = `Next Medium number in ${h}:${m}:${s}`;
    }, 1000);
}

/* =========================
   DARK MODE
========================= */
if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark-mode");
}

function toggleTheme() {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem(
        "theme",
        document.body.classList.contains("dark-mode") ? "dark" : "light"
    );
}
</script>

</body>
</html>
