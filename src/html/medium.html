<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numerals</title>

    <!-- Fontawesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="../css/style.css">

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="../../img/favicon.png">
</head>
<body>

<div class="main">
    <h1>Numerals</h1>

    <nav>
        <a href="easy.html">Easy</a> |
        <a class="active">Medium</a> |
        <a href="hard.html">Hard</a>
    </nav>

    <div class="board">
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
        <div class="row">
            <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
    </div>

    <form onsubmit="processInput(); return false;" autocomplete="off">
        <input type="text" id="userInputField" maxlength="5" placeholder="Give it a try!">

        <div>
            <button type="button" onclick="toggleTheme()">
                <i class="fa-solid fa-moon"></i>
            </button>
            <button type="button" onclick="rules()">
                <i class="fa-solid fa-file-lines"></i> How to play
            </button>
            <button type="submit" id="submitguess">
                <i class="fa-solid fa-share"></i> Submit
            </button>
        </div>
    </form>

    <div id="output"></div>
</div>

<script>

function rules() {
    alert(
        "GAME RULES\n\n" +
        "â€¢ A random number is generated at the start of the round.\n" +
        "â€¢ Your goal is to guess this number.\n" +
        "â€¢ You have 5 attempts in total.\n\n" +
        "FEEDBACK\n" +
        "â€¢ Each wrong guess is recorded.\n" +
        "â€¢ The game gives hints after every guess.\n\n" +
        "END CONDITIONS\n" +
        "â€¢ Guess the number correctly to win immediately.\n" +
        "â€¢ Use all 5 attempts without success to lose.\n\n" +
        "You can restart the game after it ends.\n\n" +
        "Good luck!"
    );
}


/* =========================
   GAME STATE (MEDIUM)
========================= */
const maxAttempts = 5;
let currentAttempt = 0;
let gameOver = false;

const rows = document.querySelectorAll(".row");
const output = document.getElementById("output");

/* =========================
   RANDOM NUMBER
========================= */
function getRandomInt() {
    return Math.floor(Math.random() * 90000) + 10000;
}

const randomNumber = getRandomInt().toString();

/* =========================
   WORDLE LOGIC (IGUAL AO EASY)
========================= */
function evaluateGuess(guess, secret) {
    const result = Array(5).fill(null);
    const used = Array(5).fill(false);

    // Green pass
    for (let i = 0; i < 5; i++) {
        if (guess[i] === secret[i]) {
            result[i] = "correct";
            used[i] = true;
        }
    }

    // Yellow pass
    for (let i = 0; i < 5; i++) {
        if (result[i]) continue;

        for (let j = 0; j < 5; j++) {
            if (!used[j] && guess[i] === secret[j]) {
                result[i] = "present";
                used[j] = true;
                break;
            }
        }
    }

    return result;
}

/* =========================
   INPUT HANDLER
========================= */
function processInput() {
    if (gameOver) return;

    const input = document.getElementById("userInputField");
    const value = input.value.trim();

    if (!/^\d{5}$/.test(value)) {
        output.textContent = "Enter exactly 5 digits.";
        return;
    }

    const guess = value.split("");
    const secret = randomNumber.split("");
    const evaluation = evaluateGuess(guess, secret);

    const cells = rows[currentAttempt].querySelectorAll(".cell");

    for (let i = 0; i < 5; i++) {
        cells[i].textContent = guess[i];
        if (evaluation[i]) {
            cells[i].classList.add(evaluation[i]);
        }
    }

    currentAttempt++;
    input.value = "";

    if (value === randomNumber) {
        output.textContent = "ðŸŽ‰ Congratulations! You won!";
        gameOver = true;
        return;
    }

    if (currentAttempt === maxAttempts) {
        output.textContent = `âŒ Game Over! The number was ${randomNumber}`;
        gameOver = true;
    }
}

/* =========================
   DARK MODE
========================= */
if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark-mode");
}

function toggleTheme() {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem(
        "theme",
        document.body.classList.contains("dark-mode") ? "dark" : "light"
    );
}
</script>

</body>
</html>
